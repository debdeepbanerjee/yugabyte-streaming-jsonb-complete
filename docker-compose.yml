version: '3.8'

services:
  yugabyte:
    image: yugabytedb/yugabyte:latest
    container_name: yugabyte-db
    ports:
      - "5433:5433"  # PostgreSQL-compatible port
      - "7000:7000"  # Master web UI
      - "9000:9000"  # Tserver web UI
    command: bin/yugabyted start --daemon=false
    volumes:
      - yugabyte-data:/home/yugabyte/var
      - ./src/main/resources:/docker-entrypoint-initdb.d
    environment:
      - YSQL_USER=yugabyte
      - YSQL_PASSWORD=yugabyte
      - YSQL_DB=yugabyte
    healthcheck:
      test: ["CMD", "bin/yugabyted", "status"]
      interval: 10s
      timeout: 5s
      retries: 10
    networks:
      - app-network

  # Optional: PgAdmin for database management
  pgadmin:
    image: dpage/pgadmin4:latest
    container_name: pgadmin
    ports:
      - "5050:80"
    environment:
      - PGADMIN_DEFAULT_EMAIL=admin@admin.com
      - PGADMIN_DEFAULT_PASSWORD=admin
    volumes:
      - pgadmin-data:/var/lib/pgadmin
    networks:
      - app-network
    depends_on:
      - yugabyte

volumes:
  yugabyte-data:
  pgadmin-data:

networks:
  app-network:
    driver: bridge
